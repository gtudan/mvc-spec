<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Ivar Grimstad, Christian Kaltepoth">
<title>MVC 1.0: Model-View-Controller Specification</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1>MVC 1.0: Model-View-Controller Specification</h1>
<div class="details">
<span id="author" class="author">Ivar Grimstad, Christian Kaltepoth</span><br>
<span id="revnumber">version 1.0 Proposed Final Draft,</span>
<span id="revdate">September 2018</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_license">License</a></li>
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#goals">1.1. Goals</a></li>
<li><a href="#non_goals">1.2. Non-Goals</a></li>
<li><a href="#additional_information">1.3. Additional Information</a></li>
<li><a href="#terminology">1.4. Terminology</a></li>
<li><a href="#conventions">1.5. Conventions</a></li>
<li><a href="#spec_leads">1.6. Specification Leads</a></li>
<li><a href="#expert_group">1.7. Expert Group Members</a></li>
<li><a href="#contributors">1.8. Contributors</a></li>
<li><a href="#acks">1.9. Acknowledgements</a></li>
</ul>
</li>
<li><a href="#mvc">2. Models, Views and Controllers</a>
<ul class="sectlevel2">
<li><a href="#controllers">2.1. Controllers</a></li>
<li><a href="#models">2.2. Models</a></li>
<li><a href="#views">2.3. Views</a></li>
</ul>
</li>
<li><a href="#data_binding">3. Data Binding</a>
<ul class="sectlevel2">
<li><a href="#data_binding_intro">3.1. Introduction</a></li>
<li><a href="#mvc_binding_annotation">3.2. @MvcBinding annotation</a></li>
<li><a href="#error_handling_bindingresult">3.3. Error handling with BindingResult</a></li>
<li><a href="#converting_parameters">3.4. Converting to Java types</a></li>
</ul>
</li>
<li><a href="#security">4. Security</a>
<ul class="sectlevel2">
<li><a href="#security_introduction">4.1. Introduction</a></li>
<li><a href="#cross-site-request-forgery">4.2. Cross-site Request Forgery</a></li>
<li><a href="#cross-site-scripting">4.3. Cross-site Scripting</a></li>
</ul>
</li>
<li><a href="#events">5. Events</a>
<ul class="sectlevel2">
<li><a href="#observers">5.1. Observers</a></li>
</ul>
</li>
<li><a href="#applications">6. Applications</a>
<ul class="sectlevel2">
<li><a href="#mvc_applications">6.1. MVC Applications</a></li>
<li><a href="#mvc_context">6.2. MVC Context</a></li>
<li><a href="#providers_in_mvc">6.3. Providers in MVC</a></li>
<li><a href="#annotation_inheritance">6.4. Annotation Inheritance</a></li>
<li><a href="#configuration_in_mvc">6.5. Configuration in MVC</a></li>
</ul>
</li>
<li><a href="#view_engines">7. View Engines</a>
<ul class="sectlevel2">
<li><a href="#view_engines_introduction">7.1. Introduction</a></li>
<li><a href="#selection_algorithm">7.2. Selection Algorithm</a></li>
<li><a href="#faces_servlet">7.3. FacesServlet</a></li>
</ul>
</li>
<li><a href="#i18n">8. Internationalization</a>
<ul class="sectlevel2">
<li><a href="#i18n_introduction">8.1. Introduction</a></li>
<li><a href="#i18n_resolving_algorithm">8.2. Resolving Algorithm</a></li>
<li><a href="#i18n_default_resolver">8.3. Default Locale Resolver</a></li>
</ul>
</li>
<li><a href="#annotation_table">Appendix A: Summary of Annotations</a></li>
<li><a href="#bibliography">Bibliography</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_license">License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This specification is dual licensed under the JCP License and the Apache 2.0 License.</p>
</div>
<div class="paragraph text-center">
<p><strong>JCP License</strong></p>
</div>
<div class="paragraph">
<p>IVAR GRIMSTAD IS WILLING TO LICENSE THIS SPECIFICATION TO YOU ONLY UPON THE CONDITION THAT YOU ACCEPT ALL OF THE TERMS
CONTAINED IN THIS AGREEMENT. PLEASE READ THE TERMS AND CONDITIONS OF THIS AGREEMENT CAREFULLY. BY DOWNLOADING THIS
SPECIFICATION, YOU ACCEPT THE TERMS AND CONDITIONS OF THE AGREEMENT. IF YOU ARE NOT WILLING TO BE BOUND BY IT,
SELECT THE "DECLINE" BUTTON AT THE BOTTOM OF THIS PAGE.</p>
</div>
<div class="paragraph">
<p>Specification:  JSR-371 MVC ("Specification")<br>
Version:  1.0<br>
Status:  Final Release<br>
Specification Lead:  Ivar Grimstad ("Specification Lead")<br>
Release:  Final Release</p>
</div>
<div class="paragraph">
<p>Copyright 2019 Ivar Grimstad (<a href="mailto:ivar.grimstad@gmail.com">ivar.grimstad@gmail.com</a>)<br>
All rights reserved.</p>
</div>
<div class="paragraph">
<p>LIMITED LICENSE GRANTS</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>License for Evaluation Purposes. Specification Lead hereby grants you a fully-paid, non-exclusive, non-transferable,
worldwide, limited license (without the right to sublicense), under Specification Lead&#8217;s  applicable intellectual
property rights to view, download, use and reproduce the Specification only for the purpose of internal evaluation.
This includes (i) developing applications intended to run on an implementation of the Specification, provided that
such applications do not themselves implement any portion(s) of the Specification, and (ii) discussing the
Specification with any third party; and (iii) excerpting brief portions of the Specification in oral or written
communications which discuss the Specification provided that such excerpts do not in the aggregate constitute a
significant portion of the Specification.</p>
</li>
<li>
<p>License for the Distribution of Compliant Implementations. Specification Lead  also grants you a perpetual,
non-exclusive, non-transferable, worldwide, fully paid-up, royalty free, limited license (without the right to
sublicense) under any applicable copyrights or, subject to the provisions of subsection 4 below, patent rights it
may have covering the Specification to create and/or distribute an Independent Implementation of the Specification
that: (a) fully implements the Specification including all its required interfaces and functionality; (b) does not
modify, subset, superset or otherwise extend the Licensor Name Space, or include any public or protected packages,
classes, Java interfaces, fields or methods within the Licensor Name Space other than those required/authorized by
the Specification or Specifications being implemented; and (c) passes the Technology Compatibility Kit (including
satisfying the requirements of the applicable TCK Users Guide) for such Specification ("Compliant Implementation").
In addition, the foregoing license is expressly conditioned on your not acting outside its scope.  No license is
granted hereunder for any other purpose (including, for example, modifying the Specification, other than to the
extent of your fair use rights, or distributing the Specification to third parties).  Also, no right, title, or
interest in or to any trademarks, service marks, or trade names of Specification Lead or Specification Lead&#8217;s
licensors is granted hereunder.  Java, and Java-related logos, marks and names are trademarks or registered
trademarks of Oracle America, Inc. in the U.S. and other countries.</p>
</li>
<li>
<p>Pass-through Conditions. You need not include limitations (a)-(c) from the previous paragraph or any other particular
"pass through" requirements in any license You grant concerning the use of your Independent Implementation or
products derived from it.  However, except with respect to Independent Implementations (and products derived from
them) that satisfy limitations (a)-(c) from the previous paragraph, You may neither:  (a) grant or otherwise pass
through to your licensees any licenses under Specification Lead&#8217;s  applicable intellectual property rights; nor
(b) authorize your licensees to make any claims concerning their implementation&#8217;s compliance with the Specification
in question.</p>
</li>
<li>
<p>Reciprocity Concerning Patent Licenses.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>With respect to any patent claims covered by the license granted under subparagraph 2 above that would be
infringed by all technically feasible implementations of the Specification, such license is conditioned upon your
offering on fair, reasonable and non-discriminatory terms, to any party seeking it from You, a perpetual,
non-exclusive, non-transferable, worldwide license under Your patent rights which are or would be infringed by all
technically feasible implementations of the Specification to develop, distribute and use a Compliant
Implementation.</p>
</li>
<li>
<p>With respect to any patent claims owned by Specification Lead and covered by the license granted under
subparagraph 2, whether or not their infringement can be avoided in a technically feasible manner when implementing
the Specification, such license shall terminate with respect to such claims if You initiate a claim against
Specification Lead that it has, in the course of performing its responsibilities as the Specification Lead,
induced any other entity to infringe Your patent rights.</p>
</li>
<li>
<p>Also with respect to any patent claims owned by Specification Lead and covered by the license granted under
subparagraph 2 above, where the infringement of such claims can be avoided in a technically feasible manner when
implementing the Specification such license, with respect to such claims, shall terminate if You initiate a claim
against Specification Lead  that its making, having made, using, offering to sell, selling or importing a
Compliant Implementation infringes Your patent rights.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Definitions. For the purposes of this Agreement:  "Independent Implementation" shall mean an implementation of the
Specification that neither derives from any of Specification Lead&#8217;s  source code or binary code materials nor, except
with an appropriate and separate license from Specification Lead, includes any of Specification Lead&#8217;s  source code or
binary code materials; "Licensor Name Space" shall mean the public class or interface declarations whose names begin
with "java", "javax", "com.&lt;Specification Lead&gt;"  or their equivalents in any subsequent naming convention adopted by
Oracle through the Java Community Process, or any recognized successors or replacements thereof; and "Technology
Compatibility Kit" or "TCK" shall mean the test suite and accompanying TCK User&#8217;s Guide provided by Specification Lead
which corresponds to the Specification and that was available either (i) from Specification Lead&#8217;s 120 days before
the first release of Your Independent Implementation that allows its use for commercial purposes, or (ii) more
recently than 120 days from such release but against which You elect to test Your implementation of the Specification.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This Agreement will terminate immediately without notice from Specification Lead if you breach the Agreement or act
outside the scope of the licenses granted above.</p>
</div>
<div class="paragraph">
<p>DISCLAIMER OF WARRANTIES</p>
</div>
<div class="paragraph">
<p>THE SPECIFICATION IS PROVIDED "AS IS". SPECIFICATION LEAD MAKES NO REPRESENTATIONS OR WARRANTIES, EITHER EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, NON-INFRINGEMENT
(INCLUDING AS A CONSEQUENCE OF ANY PRACTICE OR IMPLEMENTATION OF THE SPECIFICATION), OR THAT THE CONTENTS OF THE
SPECIFICATION ARE SUITABLE FOR ANY PURPOSE.  This document does not represent any commitment to release or implement
any portion of the Specification in any product. In addition, the Specification could include technical inaccuracies
or typographical errors.</p>
</div>
<div class="paragraph">
<p>LIMITATION OF LIABILITY</p>
</div>
<div class="paragraph">
<p>TO THE EXTENT NOT PROHIBITED BY LAW, IN NO EVENT WILL SPECIFICATION LEAD OR ITS LICENSORS BE LIABLE FOR ANY DAMAGES,
INCLUDING WITHOUT LIMITATION, LOST REVENUE, PROFITS OR DATA, OR FOR SPECIAL, INDIRECT, CONSEQUENTIAL, INCIDENTAL OR
PUNITIVE DAMAGES, HOWEVER CAUSED AND REGARDLESS OF THE THEORY OF LIABILITY, ARISING OUT OF OR RELATED IN ANY WAY TO
YOUR HAVING, IMPELEMENTING OR OTHERWISE USING USING  THE SPECIFICATION, EVEN IF SPECIFICATION LEAD AND/OR ITS LICENSORS
HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
You will indemnify, hold harmless, and defend Specification Lead and its licensors from any claims arising or resulting
from: (i) your use of the Specification; (ii) the use or distribution of your Java application, applet and/or
implementation; and/or (iii) any claims that later versions or releases of any Specification furnished to you are
incompatible with the Specification provided to you under this license.</p>
</div>
<div class="paragraph">
<p>RESTRICTED RIGHTS LEGEND</p>
</div>
<div class="paragraph">
<p>U.S. Government: If this Specification is being acquired by or on behalf of the U.S. Government or by a U.S. Government
prime contractor or subcontractor (at any tier), then the Government&#8217;s rights in the Software and accompanying
documentation shall be only as set forth in this license; this is in accordance with 48 C.F.R. 227.7201 through
227.7202-4 (for Department of Defense (DoD) acquisitions) and with 48 C.F.R. 2.101 and 12.212 (for non-DoD acquisitions).</p>
</div>
<div class="paragraph">
<p>REPORT</p>
</div>
<div class="paragraph">
<p>If you provide Specification Lead with any comments or suggestions concerning the Specification ("Feedback"), you
hereby: (i) agree that such Feedback is provided on a non-proprietary and non-confidential basis, and (ii) grant
Specification Lead a perpetual, non-exclusive, worldwide, fully paid-up, irrevocable license, with the right to
sublicense through multiple levels of sublicensees, to incorporate, disclose, and use without limitation the Feedback
for any purpose.</p>
</div>
<div class="paragraph">
<p>GENERAL TERMS</p>
</div>
<div class="paragraph">
<p>Any action related to this Agreement will be governed by California law and controlling U.S. federal law. The U.N.
Convention for the International Sale of Goods and the choice of law rules of any jurisdiction will not apply.</p>
</div>
<div class="paragraph">
<p>The Specification is subject to U.S. export control laws and may be subject to export or import regulations in other
countries. Licensee agrees to comply strictly with all such laws and regulations and acknowledges that it has the
responsibility to obtain such licenses to export, re-export or import as may be required after delivery to Licensee.</p>
</div>
<div class="paragraph">
<p>This Agreement is the parties' entire agreement relating to its subject matter. It supersedes all prior or
contemporaneous oral or written communications, proposals, conditions, representations and warranties and
prevails over any conflicting or additional terms of any quote, order,  acknowledgment, or other communication
between the parties relating to its subject matter during the term of this Agreement. No modification to this
Agreement will be binding, unless in writing and signed by an authorized representative of each party.</p>
</div>
<div class="paragraph">
<p>Rev. April, 2006</p>
</div>
<div class="paragraph text-center">
<p><strong>Apache License</strong><br>
Version 2.0, January 2004<br>
<a href="http://www.apache.org/licenses/" class="bare">http://www.apache.org/licenses/</a></p>
</div>
<div class="paragraph">
<p>TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Definitions.</p>
<div class="paragraph">
<p>"License" shall mean the terms and conditions for use, reproduction,
and distribution as defined by Sections 1 through 9 of this document.</p>
</div>
<div class="paragraph">
<p>"Licensor" shall mean the copyright owner or entity authorized by the
copyright owner that is granting the License.</p>
</div>
<div class="paragraph">
<p>"Legal Entity" shall mean the union of the acting entity and all other
entities that control, are controlled by, or are under common control
with that entity. For the purposes of this definition, "control" means
(i) the power, direct or indirect, to cause the direction or management
of such entity, whether by contract or otherwise, or (ii) ownership of
fifty percent (50 outstanding shares, or (iii) beneficial ownership of
such entity.</p>
</div>
<div class="paragraph">
<p>"You" (or "Your") shall mean an individual or Legal Entity
exercising permissions granted by this License.</p>
</div>
<div class="paragraph">
<p>"Source" form shall mean the preferred form for making modifications,
including but not limited to software source code, documentation source,
and configuration files.</p>
</div>
<div class="paragraph">
<p>"Object" form shall mean any form resulting from mechanical
transformation or translation of a Source form, including but not
limited to compiled object code, generated documentation, and
conversions to other media types.</p>
</div>
<div class="paragraph">
<p>"Work" shall mean the work of authorship, whether in Source or Object
form, made available under the License, as indicated by a copyright
notice that is included in or attached to the work (an example is
provided in the Appendix below).</p>
</div>
<div class="paragraph">
<p>"Derivative Works" shall mean any work, whether in Source or Object
form, that is based on (or derived from) the Work and for which the
editorial revisions, annotations, elaborations, or other modifications
represent, as a whole, an original work of authorship. For the purposes
of this License, Derivative Works shall not include works that remain
separable from, or merely link (or bind by name) to the interfaces of,
the Work and Derivative Works thereof.</p>
</div>
<div class="paragraph">
<p>"Contribution" shall mean any work of authorship, including the
original version of the Work and any modifications or additions to that
Work or Derivative Works thereof, that is intentionally submitted to
Licensor for inclusion in the Work by the copyright owner or by an
individual or Legal Entity authorized to submit on behalf of the
copyright owner. For the purposes of this definition, "submitted"
means any form of electronic, verbal, or written communication sent to
the Licensor or its representatives, including but not limited to
communication on electronic mailing lists, source code control systems,
and issue tracking systems that are managed by, or on behalf of, the
Licensor for the purpose of discussing and improving the Work, but
excluding communication that is conspicuously marked or otherwise
designated in writing by the copyright owner as "Not a Contribution."</p>
</div>
<div class="paragraph">
<p>"Contributor" shall mean Licensor and any individual or Legal Entity
on behalf of whom a Contribution has been received by Licensor and
subsequently incorporated within the Work.</p>
</div>
</li>
<li>
<p>Grant of Copyright License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright
license to reproduce, prepare Derivative Works of, publicly display,
publicly perform, sublicense, and distribute the Work and such
Derivative Works in Source or Object form.</p>
</li>
<li>
<p>Grant of Patent License. Subject to the terms and conditions of this
License, each Contributor hereby grants to You a perpetual, worldwide,
non-exclusive, no-charge, royalty-free, irrevocable (except as stated in
this section) patent license to make, have made, use, offer to sell,
sell, import, and otherwise transfer the Work, where such license
applies only to those patent claims licensable by such Contributor that
are necessarily infringed by their Contribution(s) alone or by
combination of their Contribution(s) with the Work to which such
Contribution(s) was submitted. If You institute patent litigation
against any entity (including a cross-claim or counterclaim in a
lawsuit) alleging that the Work or a Contribution incorporated within
the Work constitutes direct or contributory patent infringement, then
any patent licenses granted to You under this License for that Work
shall terminate as of the date such litigation is filed.</p>
</li>
<li>
<p>Redistribution. You may reproduce and distribute copies of the Work
or Derivative Works thereof in any medium, with or without
modifications, and in Source or Object form, provided that You meet the
following conditions:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>You must give any other recipients of the Work or Derivative Works
a copy of this License; and</p>
</li>
<li>
<p>You must cause any modified files to carry prominent notices
stating that You changed the files; and</p>
</li>
<li>
<p>You must retain, in the Source form of any Derivative Works that
You distribute, all copyright, patent, trademark, and attribution
notices from the Source form of the Work, excluding those notices that
do not pertain to any part of the Derivative Works; and</p>
</li>
<li>
<p>If the Work includes a "NOTICE" text file as part of its
distribution, then any Derivative Works that You distribute must include
a readable copy of the attribution notices contained within such NOTICE
file, excluding those notices that do not pertain to any part of the
Derivative Works, in at least one of the following places: within a
NOTICE text file distributed as part of the Derivative Works; within the
Source form or documentation, if provided along with the Derivative
Works; or, within a display generated by the Derivative Works, if and
wherever such third-party notices normally appear. The contents of the
NOTICE file are for informational purposes only and do not modify the
License. You may add Your own attribution notices within Derivative
Works that You distribute, alongside or as an addendum to the NOTICE
text from the Work, provided that such additional attribution notices
cannot be construed as modifying the License.</p>
<div class="paragraph">
<p>You may add Your own copyright statement to Your modifications and may
provide additional or different license terms and conditions for use,
reproduction, or distribution of Your modifications, or for any such
Derivative Works as a whole, provided Your use, reproduction, and
distribution of the Work otherwise complies with the conditions stated
in this License.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Submission of Contributions. Unless You explicitly state otherwise,
any Contribution intentionally submitted for inclusion in the Work by
You to the Licensor shall be under the terms and conditions of this
License, without any additional terms or conditions. Notwithstanding the
above, nothing herein shall supersede or modify the terms of any
separate license agreement you may have executed with Licensor regarding
such Contributions.</p>
</li>
<li>
<p>Trademarks. This License does not grant permission to use the trade
names, trademarks, service marks, or product names of the Licensor,
except as required for reasonable and customary use in describing the
origin of the Work and reproducing the content of the NOTICE file.</p>
</li>
<li>
<p>Disclaimer of Warranty. Unless required by applicable law or agreed
to in writing, Licensor provides the Work (and each Contributor provides
its Contributions) on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied, including, without
limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT,
MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. You are solely
responsible for determining the appropriateness of using or
redistributing the Work and assume any risks associated with Your
exercise of permissions under this License.</p>
</li>
<li>
<p>Limitation of Liability. In no event and under no legal theory,
whether in tort (including negligence), contract, or otherwise, unless
required by applicable law (such as deliberate and grossly negligent
acts) or agreed to in writing, shall any Contributor be liable to You
for damages, including any direct, indirect, special, incidental, or
consequential damages of any character arising as a result of this
License or out of the use or inability to use the Work (including but
not limited to damages for loss of goodwill, work stoppage, computer
failure or malfunction, or any and all other commercial damages or
losses), even if such Contributor has been advised of the possibility of
such damages.</p>
</li>
<li>
<p>Accepting Warranty or Additional Liability. While redistributing the
Work or Derivative Works thereof, You may choose to offer, and charge a
fee for, acceptance of support, warranty, indemnity, or other liability
obligations and/or rights consistent with this License. However, in
accepting such obligations, You may act only on Your own behalf and on
Your sole responsibility, not on behalf of any other Contributor, and
only if You agree to indemnify, defend, and hold each Contributor
harmless for any liability incurred by, or claims asserted against, such
Contributor by reason of your accepting any such warranty or additional
liability.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Model-View-Controller, or <em>MVC</em> for short, is a common pattern in Web frameworks where it is used predominantly to build HTML applications.
The <em>model</em> refers to the applications data, the <em>view</em> to the applications data presentation and the <em>controller</em> to the part of the
system responsible for managing input, updating models and producing output.</p>
</div>
<div class="paragraph">
<p>Web UI frameworks can be categorized as <em>action-based</em> or <em>component-based</em>. In an action-based framework, HTTP requests are
routed to controllers where they are turned into actions by application code; in a component-based framework, HTTP requests are grouped and
typically handled by framework components with little or no interaction from application code. In other words, in a component-based framework,
the majority of the controller logic is provided by the framework instead of the application.</p>
</div>
<div class="paragraph">
<p>The API defined by this specification falls into the action-based category and is, therefore, not intended to be a replacement for
component-based frameworks such as JavaServer Faces (JSF) [<a href="#jsf22">1</a>], but simply a different approach to building Web applications on the Java EE platform.</p>
</div>
<div class="sect2">
<h3 id="goals">1.1. Goals</h3>
<div class="paragraph">
<p>The following are goals of the API:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Goal 1
</td>
<td class="hdlist2">
<p>Leverage existing Java EE technologies like CDI [<a href="#cdi11">2</a>] and Bean Validation [<a href="#bv11">3</a>].</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Goal 2
</td>
<td class="hdlist2">
<p>Define a solid core to build MVCapplications without necessarily supporting all the features in its first version.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Goal 3
</td>
<td class="hdlist2">
<p>Build on top of JAX-RSfor the purpose of re-using its matching and binding layers.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Goal 4
</td>
<td class="hdlist2">
<p>Provide built-in support for JSPs and Facelets view languages.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="non_goals">1.2. Non-Goals</h3>
<div class="paragraph">
<p>The following are non-goals of the API:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Non-Goal 1
</td>
<td class="hdlist2">
<p>Define a new view (template) language and processor.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Non-Goal 2
</td>
<td class="hdlist2">
<p>Support standalone implementations of MVCrunning outside of Java EE.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Non-Goal 3
</td>
<td class="hdlist2">
<p>Support REST services not based on JAX-RS.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Non-Goal 4
</td>
<td class="hdlist2">
<p>Provide built-in support for view languages that are not part of Java EE.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is worth noting that, even though a standalone implementation of MVCthat runs outside of Java EE is a non-goal,
this specification shall not intentionally prevent implementations to run in other environments,
provided that those environments include support for all the EE technologies required by MVC.</p>
</div>
</div>
<div class="sect2">
<h3 id="additional_information">1.3. Additional Information</h3>
<div class="paragraph">
<p>The issue tracking system for this specification can be found at:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/mvc-spec/mvc-spec/issues" class="bare">https://github.com/mvc-spec/mvc-spec/issues</a></p>
</div>
<div class="paragraph">
<p>The corresponding Javadocs can be found online at:</p>
</div>
<div class="paragraph">
<p><a href="https://www.mvc-spec.org/spec/" class="bare">https://www.mvc-spec.org/spec/</a></p>
</div>
<div class="paragraph">
<p>The reference implementation can be obtained from:</p>
</div>
<div class="paragraph">
<p><a href="https://www.mvc-spec.org/ozark/" class="bare">https://www.mvc-spec.org/ozark/</a></p>
</div>
<div class="paragraph">
<p>The expert group seeks feedback from the community on any aspect of this specification, please send comments to:</p>
</div>
<div class="paragraph">
<p><a href="mailto:jsr371-users@googlegroups.com">jsr371-users@googlegroups.com</a></p>
</div>
</div>
<div class="sect2">
<h3 id="terminology">1.4. Terminology</h3>
<div class="paragraph">
<p>Most of the terminology used in this specification is borrowed from other specifications such as JAX-RSand CDI. We use the terms <em>per-request</em>
and <em>request-scoped</em> as well as <em>per-application</em> and <em>application-scoped</em> interchangeably.</p>
</div>
</div>
<div class="sect2">
<h3 id="conventions">1.5. Conventions</h3>
<div class="paragraph">
<p>The keywords `MUST', `MUST NOT', `REQUIRED', `SHALL', `SHALL NOT', `SHOULD', `SHOULD NOT', `RECOMMENDED', `MAY', and `OPTIONAL'
in this document are to be interpreted as described in RFC 2119 [<a href="#rfc2119">4</a>].</p>
</div>
<div class="paragraph">
<p>Java code and sample data fragments are formatted as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.hello;

public class Hello {
    public static void main(String args[]){
        System.out.println("Hello World");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>URIs of the general form <a href="http://example.org/">http://example.org/&#8230;&#8203;</a> and <a href="http://example.com/">http://example.com/&#8230;&#8203;</a> represent application or context-dependent URIs.</p>
</div>
<div class="paragraph">
<p>All parts of this specification are normative, with the exception of examples, notes and sections explicitly marked as `Non-Normative'.
Non-normative notes are formatted as shown below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
This is a note.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spec_leads">1.6. Specification Leads</h3>
<div class="paragraph">
<p>The following table lists the current and former specification leads:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ivar Grimstad (Individual Member)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Jan 2017 - present)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Kaltepoth (ingenit GmbH &amp; Co. KG)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(May 2017 - present)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Santiago Pericas-Geertsen (Oracle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Aug 2014 - Jan 2017)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manfred Riem (Oracle)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Aug 2014 - Jan 2017)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="expert_group">1.7. Expert Group Members</h3>
<div class="paragraph">
<p>This specification is being developed as part of <a href="https://jcp.org/en/jsr/detail?id=371">JSR 371</a> under the Java Community Process. The following are the present expert group members:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ivar Grimstad (Individual Member)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neil Griffin (Liferay, Inc)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joshua Wilson (RedHat)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rodrigo Turini (Caelum)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stefan Tilkov (innoQ Deutschland GmbH)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frank Caputo (Individual Member)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Christian Kaltepoth (ingenit GmbH &amp; Co. KG)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Woong-ki Lee (TmaxSoft, Inc.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paul Nicolucci (IBM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rahman Usta (Individual Member)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Florian Hirsch (adorsys GmbH &amp; Co KG)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Santiago Pericas-Geertsen (Oracle)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following are former members of the expert group:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guilherme de Azevedo Silveira (Individual Member)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kito D. Mann (Individual Member)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="contributors">1.8. Contributors</h3>
<div class="paragraph">
<p>The following are the contributors of the specification:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel Dias dos Santos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Phillip Krger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Andreas Badelt</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="acks">1.9. Acknowledgements</h3>
<div class="paragraph">
<p>During the course of this JSR we received many excellent suggestions. Special thanks to Marek Potociar, Dhiru Pandey and Ed Burns, all from Oracle.
In addition, to everyone in the users alias that followed the expert discussions and provided feedback, including Peter Pilgrim, Ivar Grimstad, Jozef Hartinger, Florian Hirsch, Frans Tamura, Rahman Usta, Romain Manni-Bucau, Alberto Souza, among many others.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mvc">2. Models, Views and Controllers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces the three components that comprise the
architectural pattern: models, views and controllers.</p>
</div>
<div class="sect2">
<h3 id="controllers">2.1. Controllers</h3>
<div class="paragraph">
<p><span class="tck-testable tck-id-ctrl-method">An <em>MVC controller</em> is a JAX-RS [<a href="#jaxrs20">5</a>] resource method decorated by <code>@Controller</code></span>.
<span class="tck-testable tck-id-ctrl-class">If this annotation is applied to a class, then all resource methods in it are regarded as controllers</span>.
<span class="tck-testable tck-id-ctrl-hybrid">Using the <code>@Controller</code>annotation on a subset of methods defines a hybrid class in which certain methods are controllers and others are traditional JAX-RSresource methods.</span></p>
</div>
<div class="paragraph">
<p>A simple hello-world controller can be defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("hello")
public class HelloController {

    @GET
    @Controller
    public String hello(){
        return "hello.jsp";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>hello</code> is a controller method that returns a path to a JavaServer Page (JSP).
The semantics of controller methods differ slightly from JAX-RSresource methods;
<span class="tck-testable tck-id-return-string">in particular, a return type of <code>String</code> is interpreted as a view path rather than text content</span>.
<span class="tck-testable tck-id-default-mediatype">Moreover, the default media type for a response is assumed to be <code>text/html</code>, but otherwise can be declared using <code>@Produces</code>just like in JAX-RS</span>.</p>
</div>
<div class="paragraph">
<p>A controllers method return type determines how its result is processed:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">void</dt>
<dd>
<p><span class="tck-testable tck-id-return-void">A controller method that returns void is REQUIRED to be decorated by <code>@View</code></span>.</p>
</dd>
<dt class="hdlist1">String</dt>
<dd>
<p><span class="tck-testable tck-id-return-string2">A string returned is interpreted as a view path</span>.</p>
</dd>
<dt class="hdlist1">Response</dt>
<dd>
<p><span class="tck-testable tck-id-return-response">A JAX-RS<code>Response</code> whose entitys type is one of the above</span>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following class defines equivalent controller methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
@Path("hello")
public class HelloController {

    @GET @Path("void")
    @View("hello.jsp")
    public void helloVoid() {
    }

    @GET @Path("string")
    public String helloString() {
        return "hello.jsp";
    }

    @GET @Path("response")
    public Response helloResponse() {
        return Response.status(Response.Status.OK)
            .entity("hello.jsp")
            .build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Controller methods that return a non-void type may also be decorated with<code>@View</code> as a way to specify a <em>default</em> view for the controller.
<span class="tck-testable tck-id-non-null-viewable">The default view MUST be used only when such a non-void controller method returns a <code>null</code> value</span>.</p>
</div>
<div class="paragraph">
<p>Note that, even though controller methods return types are restricted as explained above, MVCdoes not impose any restrictions on parameter types available to controller methods:
i.e.,
<span class="tck-testable tck-id-inject-param-types">all parameter types injectable in JAX-RSresources are also available in controllers</span>.
<span class="tck-testable tck-id-inject-field-props">Likewise, injection of fields and properties is unrestricted and fully compatible with JAX-RS</span>.
Note the restrictions explained in Section <a href="#controller_instances">Controller Instances</a>.</p>
</div>
<div class="paragraph">
<p>Controller methods handle a HTTP request directly. Sub-resource locators as described in the JAX-RSSpecification [<a href="#jaxrs20">5</a>] are not supported by MVC.</p>
</div>
<div class="sect3">
<h4 id="controller_instances">2.1.1. Controller Instances</h4>
<div class="paragraph">
<p>Unlike in JAX-RSwhere resource classes can be native (created and managed by JAX-RS), CDI beans, managed beans or EJBs,
<span class="tck-testable tck-id-ctrl-cdi">MVCclasses are REQUIRED to be CDI-managed beans only</span>.
<span class="tck-testable tck-id-ctrl-cdi-hybrid">It follows that a hybrid class that contains a mix of JAX-RSresource methods and MVCcontrollers must also be CDI managed</span>.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-request-scope-default">Like in JAX-RS, the default resource class instance lifecycle is <em>per-request</em></span>.
Implementations MAY support other lifecycles via CDI; the same caveats that apply to JAX-RSclasses in other lifecycles applied to MVCclasses.
<span class="tck-testable tck-id-scope-proxy">In particular, CDI may need to create proxies when, for example, a per-request instance is as a member of a per-application instance</span>.
See [<a href="#jaxrs20">5</a>] for more information on lifecycles and their caveats.</p>
</div>
</div>
<div class="sect3">
<h4 id="response">2.1.2. Response</h4>
<div class="paragraph">
<p><span class="tck-testable tck-id-response-header">Returning a <code>Response</code>object gives applications full access to all the parts in a response, including the headers</span>.
For example, an instance of <code>Response</code>can modify the HTTP status code upon encountering an error condition;
JAX-RSprovides a fluent API to build responses as shown next.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET
@Controller
public Response getById(@PathParam("id") String id) {
    if (id.length() == 0) {
        return Response.status(Response.Status.BAD_REQUEST)
            .entity("error.jsp")
            .build();
    }
    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Direct access to <code>Response</code>enables applications to override content types, set character encodings, set cache control policies, trigger an HTTP redirect, etc.
For more information, the reader is referred to the Javadoc for the <code>Response</code>class.</p>
</div>
</div>
<div class="sect3">
<h4 id="redirect">2.1.3. Redirect and @RedirectScoped</h4>
<div class="paragraph">
<p>As stated in the previous section, <span class="tck-testable tck-id-redirect-response">controllers can redirect clients by returning a <code>Response</code> instance using the JAX-RSAPI</span>.
For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET
@Controller
public Response redirect() {
    return Response.seeOther(URI.create("see/here")).build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the popularity of the POST-redirect-GET pattern,
<span class="tck-testable tck-id-redirect-prefix">MVC implementations are REQUIRED to support view paths prefixed by <code>redirect:</code> as a more concise way to trigger a client redirect</span>.
Using this prefix, the controller shown above can be re-written as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET
@Controller
public String redirect() {
    return "redirect:see/here";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-redirect-relative">In either case, relative paths are resolved relative to the JAX-RS application path</span> - for more information please refer to the Javadoc for the <code>seeOther</code> method.
It is worth noting that redirects require client cooperation (all browsers support it, but certain CLI clients may not) and result in a completely new request-response cycle in order to access the intended controller.
If a controller returns a <code>redirect:</code> view path, <span class="tck-testable tck-id-redirect-303-302">MVC implementations SHOULD use the 303 (See other) status code for the redirect, but MAY prefer 302 (Found) if HTTP 1.0 compatibility is required.</span></p>
</div>
<div class="paragraph">
<p>MVC applications can leverage CDI by defining beans in scopes such as request and session.
<span class="tck-testable tck-id-scope-request">A bean in request scope is available only during the processing of a single request</span>,
<span class="tck-testable tck-id-scope-session">while a bean in session scope is available throughout an entire web session which can potentially span tens or even hundreds of requests</span>.</p>
</div>
<div class="paragraph">
<p>Sometimes it is necessary to share data between the request that returns a redirect instruction and the new request that is triggered as a result.
That is, a scope that spans at most two requests and thus fits between a request and a session scope.
For this purpose, the MVC API defines a new CDI scope identified by the annotation <code>@RedirectScoped</code>.
<span class="tck-testable tck-id-scope-redirect">CDI beans in this scope are automatically created and destroyed by correlating a redirect and the request that follows</span>.
The exact mechanism by which requests are correlated is implementation dependent, but popular techniques include URL rewrites and cookies.</p>
</div>
<div class="paragraph">
<p>Let us assume that <code>MyBean</code> is annotated by <code>@RedirectScoped</code> and given the name <code>mybean</code>, and consider the following controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
@Path("submit")
public class MyController {

    @Inject
    private MyBean myBean;

    @POST
    public String post() {
        myBean.setValue("Redirect about to happen");
        return "redirect:/submit";
    }

    @GET
    public String get() {
        return "mybean.jsp"; // mybean.value accessed in JSP
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean <code>myBean</code> is injected in the controller and available not only during the first <code>POST</code>, but also during the subsequent <code>GET</code> request,
enabling <em>communication</em> between the two interactions; the creation and destruction of the bean is under control of CDI,
and thus completely transparent to the application just like any other built-in scope.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="models">2.2. Models</h3>
<div class="paragraph">
<p>MVCcontrollers are responsible for combining data models and views (templates) to produce web application pages.
This specification supports two kinds of models: the first is based on CDI <code>@Named</code>beans,
and the second on the <code>Models</code>interface which defines a map between names and objects.
<span class="tck-testable tck-id-builtin-both-models">MVC provides view engines for JSP and Facelets out of the box, which support both types</span>.
For all other view engines supporting the <code>Models</code> interface is mandatory,
support for CDI <code>@Named</code>beans is OPTIONAL but highly RECOMMENDED.</p>
</div>
<div class="paragraph">
<p>Let us now revisit our hello-world example, this time also showing how to update a model. Since we intend to show the two ways in which models
can be used, we define the model as a CDI <code>@Named</code>bean in request scope even though this is only necessary for the CDI case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("greeting")
@RequestScoped
public class Greeting {

    private String message;

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-cdi-model-inject">Given that the view engine for JSPs supports <code>@Named</code>beans, all the controller needs to do is fill out the model and return the view</span>.
Access to the model is straightforward using CDI injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("hello")
public class HelloController {

    @Inject
    private Greeting greeting;

    @GET
    @Controller
    public String hello() {
        greeting.setMessage("Hello there!");
        return "hello.jsp";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-cdi-model-el">This will allow the view to access the greeting using the EL expression</span> <code>${hello.greeting}</code>.</p>
</div>
<div class="paragraph">
<p>Instead of using CDI beans annotated with <code>@Named</code>, <span class="tck-testable tck-id-models-inject">controllers can also use the <code>Models</code>map to pass data to the view</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("hello")
public class HelloController {

    @Inject
    private Models models;

    @GET
    @Controller
    public String hello() {
        models.put("greeting", new Greeting("Hello there!"));
        return "hello.jsp";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the model is given the same name as that in the <code>@Named</code> annotation above, but using the injectable <code>Models</code>map instead.</p>
</div>
<div class="paragraph">
<p>For more information about view engines see the <a href="#view_engines">View Engines</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="views">2.3. Views</h3>
<div class="paragraph">
<p>A <em>view</em>, sometimes also referred to as a template, defines the structure of the output page and can refer to one or more models.
It is the responsibility of a <em>view engine</em> to process (render) a view by extracting the information in the models and producing the output page.</p>
</div>
<div class="paragraph">
<p>Here is the JSP page for the hello-world example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;${greeting.message}&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-jsp-el">In a JSP, model properties are accessible via EL</span> [<a href="#el30">6</a>]. In the example above, the property <code>message</code> is read from the <code>greeting</code> model
whose name was either specified in a <code>@Named</code> annotation or used as a key in the <code>Models</code> map, depending on which controller from the <a href="#models">Models</a> section triggered this view&#8217;s processing.</p>
</div>
<div class="paragraph">
<p>Here is the corresponding example using Facelets instead of JSP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html lang="en" xmlns:h="http://xmlns.jcp.org/jsf/html"&gt;
    &lt;h:head&gt;
        &lt;title&gt;Hello&lt;/title&gt;
    &lt;/h:head&gt;
    &lt;h:body&gt;
        &lt;h:outputText value="#{greeting.message}" /&gt;
    &lt;/h:body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="mvc_uri">2.3.1. Building URIs in a View</h4>
<div class="paragraph">
<p>A typical application requires to build URIs for the view, which often refer to controller methods within the same application.
Typical examples for such URIs include HTML links and form actions.
As building URIs manually is difficult and duplicating path patterns between the controller class and the view is error prone,
MVC provides a simple way to generate URIs using the <code>MvcContext</code> class.</p>
</div>
<div class="paragraph">
<p>See the following controller as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
@Path("books")
public class BookController {

    @GET
    public String list() {
      // ...
    }

    @GET
    @Path("{id}")
    public String detail( @PathParam("id") long id ) {
      // ...
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the application is deployed with the context path <code>/myapp</code> and is using the application path <code>/mvc</code>,
<span class="tck-testable tck-id-el-access">URIs for these controller methods can be created with an EL expression</span> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!-- /myapp/mvc/books --&gt;
${mvc.uri('BookController#list')}

&lt;!-- /myapp/mvc/books/1234 --&gt;
${mvc.uri('BookController#detail', { 'isbn': 1234 })}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-class-method-name">The controller method is referenced using the simple name of the controller class and the corresponding method name separated by <code>#</code></span>.
<span class="tck-testable tck-id-param-map">If the URI contains path, query or matrix parameters, concrete values can be supplied using a map</span>.
Please note that the keys of this map must match the parameter name used in the <code>@PathParam</code>, <code>@QueryParam</code> or <code>@MatrixParam</code> annotation.
<span class="tck-testable tck-id-uri-encoding">MVC implementations MUST apply the corresponding URI encoding rules depending on whether the value is used in a query, path or matrix parameter</span>.</p>
</div>
<div class="paragraph">
<p>The syntax used above to reference the controller method works well in most cases.
However, because of the simple nature of this reference style, it will require controller class names to be unique.
Also, the references may break if the controller class or method name changes as part of a refactoring.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-uri-ref">Therefore, applications can use the <code>@UriRef</code> annotation to define a stable and unique name for a controller method</span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
@Path("books")
public class BookController {

    @GET
    @UriRef("book-list")
    public String list() {
      // ...
    }

    // ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given such a controller class, the view can generate a matching URI by referencing the controller method using this reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!-- /myapp/mvc/books --&gt;
${mvc.uri('book-list')}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that this feature will work with JSP, Facelets and all view engines which support invoking methods on CDI model objects.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data_binding">3. Data Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter discusses data binding in the MVCAPI.
Data binding is based on the underlying mechanism provided by JAX-RS,
but with additional support for i18n requirements and for handling data binding errors within the controller.</p>
</div>
<div class="sect2">
<h3 id="data_binding_intro">3.1. Introduction</h3>
<div class="paragraph">
<p>JAX-RS provides support for binding request parameters (like form/query parameters) to resource fields or resource method parameters.
Starting with JAX-RS 2.0, developers can also specify validation constraints using Bean Validation annotations.
In this case submitted values are automatically validated against the given constraints and rejected if validation fails.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the following resource for an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("form")
public class FormResource {

    @FormParam("age")
    @Min(18)
    private int age;

    @POST
    public Response handlePost() {
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This resource uses a <code>@FormParam</code> annotation to bind the value of the <code>age</code> form parameter to a resource field.
It also uses the Bean Validation annotation <code>@Min</code> to specify a constraint on the value.</p>
</div>
<div class="paragraph">
<p>When JAX-RS binds the submitted data to the field, two types of errors are possible:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Binding Error
</td>
<td class="hdlist2">
<p>This type occurs if JAX-RS is unable to convert the submitted value into the desired target Java type.
For the resource shown above, such an error will be thrown if the user submits some arbitrary string like <code>foobar</code> which cannot be converted into an integer.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Validation Error
</td>
<td class="hdlist2">
<p>If the submitted value can be converted into the target type, JAX-RS will validate the data according to the Bean Validation constraints.
In our example submitting the value 16 would be considered invalid and therefore result in a constraint violation.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unfortunately the JAX-RS data binding mechanism doesn&#8217;t work well for web applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Both binding and validation errors will cause JAX-RS to throw an exception which can only be handled by an <code>ExceptionMapper</code>.
Especially JAX-RS won&#8217;t execute the resource method if errors were detected.
This is problematic, because typically web applications will want to display the submitted form again and include a message explaining why the submission failed.
Implementing such a requirement using an <code>ExceptionMapper</code> is not feasible.</p>
</li>
<li>
<p>The JAX-RS data binding is not locale-aware.
This is a problem especially for numeric data types containing fraction digits (like <code>double</code>, <code>float</code>, <code>BigDecimal</code>, etc).
By default, JAX-RS will always assume the US number format.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="mvc_binding_annotation">3.2. @MvcBinding annotation</h3>
<div class="paragraph">
<p>MVC addresses the shortcomings of the standard JAX-RS data binding by providing a special data binding mode optimized for web applications.
<span class="tck-testable tck-id-mvc-binding">You can enable the MVC specific data binding by adding a <code>@MvcBinding</code> annotation to the corresponding controller field or method parameter</span>.</p>
</div>
<div class="paragraph">
<p>The following example shows a controller which uses a MVC binding on a controller field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
@Path("form")
public class FormController {

    @MvcBinding
    @FormParam("age")
    @Min(18)
    private int age;

    @POST
    public String processForm() {
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that usually <code>@MvcBinding</code> will be used with <code>@FormParam</code> and <code>@QueryParam</code> bindings, as they are very common in web application.
However, depending on the specific use case, it may also be useful to use it with other parameter binding types.
<span class="tck-testable tck-id-all-binding-annotations">Therefore, MVC implementations MUST support <code>@MvcBinding</code> with all JAX-RS binding annotations</span>.</p>
</div>
<div class="paragraph">
<p>The following sections will describe the differences from traditional JAX-RS data binding in detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="error_handling_bindingresult">3.3. Error handling with BindingResult</h3>
<div class="paragraph">
<p>As mentioned in the first section, JAX-RS data binding aborts request processing for any binding or validation error.
This means, that a resource method will only be invoked if all bindings were successful.</p>
</div>
<div class="paragraph">
<p>MVC bindings handle such errors in a different way.
<span class="tck-testable tck-id-invoke-controller">An MVC implementation is required to invoke the matched controller method even if binding or validation errors occurred</span>.
<span class="tck-testable tck-id-inject-binding-result">Controllers can inject a request-scoped instance of <code>BindingResult</code> to access details about potential data binding errors</span>.
This allows controllers to handle such errors themselves, which typically means that human-readable error messages are presented to the user when the next view is rendered.</p>
</div>
<div class="paragraph">
<p>The following example shows a controller which uses <code>BindingResult</code> to handle data binding errors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
@Path("form")
public class FormController {

    @MvcBinding
    @FormParam("age")
    @Min(18)
    private int age;

    @Inject
    private BindingResult bindingResult;

    @Inject
    private Models models;

    @POST
    public String processForm() {

        if( bindingResult.isFailed() ) {
            models.put( "errors", bindingResult.getAllMessages() );
            return "form.jsp";
        }

        // process the form request

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that it is very important for a controller to actually check the <code>BindingResult</code> for errors if it uses MVC bindings.
If a binding failed and the controller processes the value without checking for errors, the bound value may be empty or contain an invalid value.</p>
</div>
<div class="paragraph">
<p>MVC implementations SHOULD log a warning if a request created data binding errors but the controller didn&#8217;t invoke any method on <code>BindingResult</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="converting_parameters">3.4. Converting to Java types</h3>
<div class="paragraph">
<p>The standard JAX-RS data binding doesn&#8217;t work very well for web application,
because it isn&#8217;t locale-aware and some standard HTML form elements submit data which cannot easily be bound to matching Java types
(e.g. checkboxes are submitting <code>on</code> if checked and JAX-RS is expecting <code>true</code> for boolean values).</p>
</div>
<div class="paragraph">
<p>MVC implementations are required to apply the following data conversion rules if a binding is annotated with <code>@MvcBinding</code>.</p>
</div>
<div class="sect3">
<h4 id="numeric_types">3.4.1. Numeric types</h4>
<div class="paragraph">
<p>Implementations MUST support <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>BigDecimal</code>, <code>BigInteger</code> and corresponding wrapper types for MVC bindings.
Support for other numeric types is optional.
<span class="tck-testable tck-id-convert-numeric">When converting values to these numeric Java types, MVC implementations MUST use the current <em>request locale</em> for parsing non-empty strings</span>.
Typically, an implementation will use a <code>NumberFormat</code> instance initialized with the corresponding locale for converting the data.
<span class="tck-testable tck-id-convert-empty-numeric">Empty strings are either converted to <code>null</code> or to the default value of the corresponding primitive data type</span>.
Please refer to the <a href="#i18n">Internationalization</a> section for details about the MVC request locale.</p>
</div>
</div>
<div class="sect3">
<h4 id="boolean_type">3.4.2. Boolean type</h4>
<div class="paragraph">
<p><span class="tck-testable tck-id-convert-boolean">When an MVC implementation converts a non-empty string to a <code>boolean</code> primitive type or the <code>java.lang.Boolean</code> wrapper type, it MUST convert both <code>true</code> and <code>on</code> to the boolean <code>true</code> and all others strings to <code>false</code></span>.
<span class="tck-testable tck-id-convert-empty-boolean">Empty strings are converted to <code>false</code> in case of the primitive <code>boolean</code> type and to <code>null</code> for the wrapper type</span>.</p>
</div>
</div>
<div class="sect3">
<h4 id="other_types">3.4.3. Other types</h4>
<div class="paragraph">
<p>The conversion rules for all other Java types are implementation-specific.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security">4. Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="security_introduction">4.1. Introduction</h3>
<div class="paragraph">
<p>Guarding against malicious attacks is a great concern for web application developers. In particular, MVC applications that accept
input from a browser are often targetted by attackers. Two of the most common forms of attacks are cross-site request forgery (CSRF)
and cross-site scripting (XSS). This chapter explores techniques to prevent these type of attacks with the aid of the MVC API.</p>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-request-forgery">4.2. Cross-site Request Forgery</h3>
<div class="paragraph">
<p>Cross-site Request Forgery (CSRF) is a type of attack in which a user, who has a trust relationship with a certain site, is mislead into
executing some commands that exploit the existence of such a trust relationship. The canonical example for this attack is that of a user
unintentionally carrying out a bank transfer while visiting another site.</p>
</div>
<div class="paragraph">
<p>The attack is based on the inclusion of a link or script in a page that accesses a site to which the user is known or assumed to have been
authenticated (trusted). Trust relationships are often stored in the form of cookies that may be active while the user is visiting other
sites. For example, such a malicious site could include the following HTML snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;img src="http://yourbank.com/transfer?from=yours&amp;to=mine&amp;sum=1000000"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will result in the browser executing a bank transfer in an attempt to load an image.</p>
</div>
<div class="paragraph">
<p>In practice, most sites require the use of form posts to submit requests such as bank transfers. The common way to prevent CSRF attacks is by
embedding additional, difficult-to-guess data fields in requests that contain sensible commands. This additional data, known as a token, is
obtained from the trusted site but unlike cookies it is never stored in the browser.</p>
</div>
<div class="paragraph">
<p>MVC implementations provide CSRF protection using the <code>Csrf</code> object and the <code>@CsrfProtected</code> annotation.
<span class="tck-testable tck-id-csrf-obj">The <code>Csrf</code> object is available to applications via the injectable <code>MvcContext</code> type or in EL as <code>mvc.csrf</code></span>.
For more information about <code>MvcContext</code>, please refer to the <a href="#mvc_context">MVC Context</a> section.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-csrf-hidden-field">Applications may use the <code>Csrf</code> object to inject a hidden field in a form that can be validated upon submission</span>.
Consider the following JSP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;CSRF Protected Form&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form action="csrf" method="post" accept-charset="utf-8"&gt;
            &lt;input type="submit" value="Click here"/&gt;
            &lt;input type="hidden" name="${mvc.csrf.name}"
                value="${mvc.csrf.token}"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The hidden field will be submitted with the form, giving the MVC implementation the opportunity to verify the token and ensure the
validity of the post request.</p>
</div>
<div class="paragraph">
<p>Another way to convey this information to and from the client is via an HTTP header.
<span class="tck-testable tck-id-csrf-verify">MVC implementations are REQUIRED to support CSRF tokens both as form fields (with the help of the application developer as shown above) and as HTTP headers</span>.</p>
</div>
<div class="paragraph">
<p>The application-level property <code>javax.mvc.security.CsrfProtection</code> enables CSRF protection when set to one of the possible values defined in <code>javax.mvc.security.Csrf.CsrfOptions</code>.
<span class="tck-testable tck-id-csrf-opt-default">The default value of this property is <code>CsrfOptions.EXPLICIT</code></span>.
<span class="tck-testable tck-id-csrf-inject-header">Any other value than <code>CsrfOptions.OFF</code> will automatically inject a CSRF token as an HTTP header</span>.
<span class="tck-testable tck-id-csrf-custom-header-name">The actual name of the header can be configured via the <code>Csrf.CSRF_HEADER_NAME</code> configuration property</span>.
<span class="tck-testable tck-id-csrf-default-header-name">The default name of the header is <code>Csrf.DEFAULT_CSRF_HEADER_NAME</code></span>.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-csrf-implicit">Automatic validation is enabled by setting this property to <code>CsrfOptions.IMPLICIT</code>, in which case all post requests must include either an HTTP header or a hidden field with the correct token</span>.
<span class="tck-testable tck-id-csrf-explict">Finally, if the property is set to <code>CsrfOptions.EXPLICIT</code> then application developers must annotate controllers using <code>@CsrfProtected</code> to manually enable validation as shown in the following example</span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("csrf")
@Controller
public class CsrfController {

    @GET
    public String getForm() {
        return "csrf.jsp"; // Injects CSRF token
    }

    @POST
    @CsrfProtected // Required for CsrfOptions.EXPLICIT
    public void postForm(@FormParam("greeting") String greeting) {
        // Process greeting
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-csrf-mediatype">MVC implementations are required to support CSRF validation of tokens for controllers annotated with <code>@POST</code> and consuming the media type <code>x-www-form-urlencoded</code></span>;
other media types and scenarios may also be supported but are OPTIONAL.</p>
</div>
<div class="paragraph">
<p>If CSRF protection is enabled for a controller method and the CSRF validation fails (because the token is either missing or invalid),
<span class="tck-testable tck-id-csrf-exception">the MVC implementation MUST throw a <code>javax.mvc.security.CsrfValidationException</code></span>.
<span class="tck-testable tck-id-csrf-default-mapper">The implementation MUST provide a default exception mapper for this exception which handles it by responding with a 403 (Forbidden) status code</span>.
<span class="tck-testable tck-id-csrf-custom-mapper">Applications MAY provide a custom exception mapper for <code>CsrfValidationException</code> to change this default behavior</span>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-scripting">4.3. Cross-site Scripting</h3>
<div class="paragraph">
<p>Cross-site scripting (XSS) is a type of attack in which snippets of scripting code are injected and later executed when returned back from a
server. The typical scenario is that of a website with a search field that does not validate its input, and returns an error message that
includes the value that was submitted. If the value includes a snippet of the form <code>&lt;script&gt;&#8230;&#8203;&lt;/script&gt;</code> then it will be executed by the browser when
the page containing the error is rendered.</p>
</div>
<div class="paragraph">
<p>There are lots of different variations of this the XSS attack, but most can be prevented by ensuring that the data submitted by clients is
properly <em>sanitized</em> before it is manipulated, stored in a database, returned to the client, etc. Data escaping/encoding is the recommended
way to deal with untrusted data and prevent XSS attacks.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-xss-encoders-obj">MVC applications can gain access to encoders through the <code>MvcContext</code> object</span>;
<span class="tck-testable tck-id-xss-escaping">the methods defined by <code>javax.mvc.security.Encoders</code> can be used by applications to contextually encode data in an attempt to prevent XSS attacks</span>.
The reader is referred to the Javadoc for this type for further information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events">5. Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces a mechanism by which MVC applications can be informed of important events that occur while processing a request.
This mechanism is based on CDI events that can be fired by implementations and observed by applications.</p>
</div>
<div class="sect2">
<h3 id="observers">5.1. Observers</h3>
<div class="paragraph">
<p>The package <code>javax.mvc.event</code> defines a number of event types that MUST be fired by implementations during the processing of a request.
Implementations MAY extend this set and also provide additional information on any of the events defined by this specification.
The reader is referred to the implementations documentation for more information on event support.</p>
</div>
<div class="paragraph">
<p>Observing events can be useful for applications to learn about the lifecycle of a request, perform logging, monitor performance, etc.
<span class="tck-testable tck-id-before-after-controller">The events <code>BeforeControllerEvent</code> and <code>AfterControllerEvent</code> are fired around the invocation of a controller</span>.
<span class="tck-testable tck-id-after-controller-exception">Please note that <code>AfterControllerEvent</code> is always fired, even if the controller fails with an exception</span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * &lt;p&gt;Event fired before a controller is called but after it has been matched.&lt;/p&gt;
 *
 * &lt;p&gt;For example:
 * &lt;pre&gt;&lt;code&gt;    public class EventObserver {
 *         public void beforeControllerEvent(&amp;#64;Observes BeforeControllerEvent e) {
 *            ...
 *        }
 *    }&lt;/code&gt;&lt;/pre&gt;
 *
 * @author Santiago Pericas-Geertsen
 * @see javax.enterprise.event.Observes
 * @since 1.0
 */
public interface BeforeControllerEvent extends MvcEvent {

    /**
     * Access to the current request URI information.
     *
     * @return URI info.
     * @see javax.ws.rs.core.UriInfo
     */
    UriInfo getUriInfo();

    /**
     * Access to the current request controller information.
     *
     * @return resources info.
     * @see javax.ws.rs.container.ResourceInfo
     */
    ResourceInfo getResourceInfo();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * &lt;p&gt;Event fired after a controller method returns. This event is always fired,
 * even if the controller methods fails with an exception. Must be fired after
 * {@link javax.mvc.event.BeforeControllerEvent}.&lt;/p&gt;
 *
 * &lt;p&gt;For example:
 * &lt;pre&gt;&lt;code&gt;    public class EventObserver {
 *         public void afterControllerEvent(&amp;#64;Observes AfterControllerEvent e) {
 *            ...
 *        }
 *    }&lt;/code&gt;&lt;/pre&gt;
 *
 * @author Santiago Pericas-Geertsen
 * @author Christian Kaltepoth
 * @see javax.enterprise.event.Observes
 * @since 1.0
 */
public interface AfterControllerEvent extends MvcEvent {

    /**
     * Access to the current request URI information.
     *
     * @return URI info.
     * @see javax.ws.rs.core.UriInfo
     */
    UriInfo getUriInfo();

    /**
     * Access to the current request controller information.
     *
     * @return resources info.
     * @see javax.ws.rs.container.ResourceInfo
     */
    ResourceInfo getResourceInfo();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applications can monitor these events using an observer as shown next.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class EventObserver {

    public void onBeforeController(@Observes BeforeControllerEvent e) {
        System.out.println("URI: " + e.getUriInfo().getRequestUri());
    }

    public void onAfterController(@Observes AfterControllerEvent e) {
        System.out.println("Controller: " +
        e.getResourceInfo().getResourceMethod());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observer methods in CDI are defined using the <code>@Observes</code> annotation on a parameter position.
The class <code>EventObserver</code> is a CDI bean in application scope whose methods <code>onBeforeController</code> and <code>onAfterController</code> are called before and after a controller is called.</p>
</div>
<div class="paragraph">
<p>Each event includes additional information that is specific to the event;
for example, the events shown in the example above allow applications to get information about the request URI and the resource (controller) selected.</p>
</div>
<div class="paragraph">
<p>The <a href="#view_engines">View Engines</a> section describes the algorithm used by implementations to select a specific view engine for processing; after a view engine is selected, the method <code>processView</code> is called.
<span class="tck-testable tck-id-before-after-view">The events <code>BeforeProcessViewEvent</code> and <code>AfterProcessViewEvent</code> are fired around this call</span>.
<span class="tck-testable tck-id-after-view-exception">Please note that <code>AfterProcessViewEvent</code> is always fired, even if the view engine fails with an exception</span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * &lt;p&gt;Event fired after a view engine has been selected but before its
 * {@link javax.mvc.engine.ViewEngine#processView(javax.mvc.engine.ViewEngineContext)}
 * method is called. Must be fired after {@link javax.mvc.event.ControllerRedirectEvent},
 * or if that event is not fired, after {@link javax.mvc.event.AfterControllerEvent}.&lt;/p&gt;
 *
 * &lt;p&gt;For example:
 * &lt;pre&gt;&lt;code&gt;    public class EventObserver {
 *         public void beforeProcessView(&amp;#64;Observes BeforeProcessViewEvent e) {
 *            ...
 *        }
 *    }&lt;/code&gt;&lt;/pre&gt;
 *
 * @author Santiago Pericas-Geertsen
 * @see javax.enterprise.event.Observes
 * @since 1.0
 */
public interface BeforeProcessViewEvent extends MvcEvent {

    /**
     * Returns the view being processed.
     *
     * @return the view.
     */
    String getView();

    /**
    * Returns the {@link javax.mvc.engine.ViewEngine} selected by the implementation.
            *
            * @return the view engine selected.
            */
    Class&lt;? extends ViewEngine&gt; getEngine();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * &lt;p&gt;Event fired after the view engine method
 * {@link javax.mvc.engine.ViewEngine#processView(javax.mvc.engine.ViewEngineContext)}
 * returns. This event is always fired, even if the view engine fails with an exception.
 * Must be fired after {@link javax.mvc.event.BeforeProcessViewEvent}.&lt;/p&gt;
 *
 * &lt;p&gt;For example:
 * &lt;pre&gt;&lt;code&gt;    public class EventObserver {
 *         public void afterProcessView(&amp;#64;Observes AfterProcessViewEvent e) {
 *            ...
 *        }
 *    }&lt;/code&gt;&lt;/pre&gt;
 *
 * @author Santiago Pericas-Geertsen
 * @author Christian Kaltepoth
 * @see javax.enterprise.event.Observes
 * @since 1.0
 */
public interface AfterProcessViewEvent extends MvcEvent {

    /**
     * Returns the view being processed.
     *
     * @return the view.
     */
    String getView();

    /**
     * Returns the {@link javax.mvc.engine.ViewEngine} selected by the implementation.
     *
     * @return the view engine selected.
     */
    Class&lt;? extends ViewEngine&gt; getEngine();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These events can be observed in a similar manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class EventObserver {

    public void onBeforeProcessView(@Observes BeforeProcessViewEvent e) {
        // ...
    }

    public void onAfterProcessView(@Observes AfterProcessViewEvent e) {
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the example, let us assume that the information about the selected view engine needs to be conveyed to the client.
To ensure that this information is available to a view returned to the client,
the <code>EventObserver</code> class can inject and update the same request-scope bean accessed by such a view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class EventObserver {

    @Inject
    private EventBean eventBean;

    public void onBeforeProcessView(@Observes BeforeProcessViewEvent e) {
        eventBean.setView(e.getView());
        eventBean.setEngine(e.getEngine());
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the interaction between views and models, the reader is referred to the<a href="#models">Models</a> section.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-redirect-event">The last event supported by MVC is <code>ControllerRedirectEvent</code>, which is fired just before the MVC implementation returns a redirect status code</span>.
<span class="tck-testable tck-id-redirect-after-controller-event">Please note that this event MUST be fired after <code>AfterControllerEvent</code></span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.net.URI;

/**
 * &lt;p&gt;Event fired when a controller triggers a redirect. Only the
 * status codes 301 (moved permanently), 302 (found), 303 (see other) and
 * 307 (temporary redirect) are REQUIRED to be reported. Note that the
 * JAX-RS methods
 * {@link javax.ws.rs.core.Response#seeOther(java.net.URI)}} and
 * {@link javax.ws.rs.core.Response#temporaryRedirect(java.net.URI)}}
 * use the status codes to 303 and 307, respectively. Must be
 * fired after {@link javax.mvc.event.AfterControllerEvent}.&lt;/p&gt;
 *
 * &lt;p&gt;For example:
 * &lt;pre&gt;&lt;code&gt;    public class EventObserver {
 *         public void onControllerRedirect(&amp;#64;Observes ControllerRedirectEvent e) {
 *            ...
 *        }
 *    }&lt;/code&gt;&lt;/pre&gt;
 *
 * @author Santiago Pericas-Geertsen
 * @see javax.enterprise.event.Observes
 * @since 1.0
 */
public interface ControllerRedirectEvent extends MvcEvent {

    /**
     * Access to the current request URI information.
     *
     * @return URI info.
     * @see javax.ws.rs.core.UriInfo
     */
    UriInfo getUriInfo();

    /**
     * Access to the current request controller information.
     *
     * @return resources info.
     * @see javax.ws.rs.container.ResourceInfo
     */
    ResourceInfo getResourceInfo();

    /**
     * The target of the redirection.
     *
     * @return URI of redirection.
     */
    URI getLocation();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>CDI events fired by implementations are <em>synchronous</em>, so it is recommended that applications carry out only simple tasks in their observer methods,
avoiding long-running computations as well as blocking calls.
For a complete list of events, the reader is referred to the Javadoc for the <code>javax.mvc.event</code> package.</p>
</div>
<div class="paragraph">
<p>Event reporting requires the MVC implementations to create event objects before firing.
In high-throughput systems without any observers the number of unnecessary objects created may not be insignificant.
For this reason, it is RECOMMENDED for implementations to consider smart firing strategies when no observers are present.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applications">6. Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces the notion of an MVC application and explains how it relates to a JAX-RS application.</p>
</div>
<div class="sect2">
<h3 id="mvc_applications">6.1. MVC Applications</h3>
<div class="paragraph">
<p>An MVC application consists of one or more JAX-RS resources that are annotated with <code>@Controller</code> and, just like JAX-RS applications, zero or more providers.
If no resources are annotated with <code>@Controller</code>, then the resulting application is a JAX-RS application instead.
In general, everything that applies to a JAX-RS application also applies to an MVC application.
Some MVC applications may be <em>hybrid</em> and include a mix of MVC controllers and JAX-RS resource methods.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-application-class">The controllers and providers that make up an application are configured via an application-supplied subclass of <code>Application</code> from JAX-RS</span>.
An implementation MAY provide alternate mechanisms for locating controllers, but as in JAX-RS, the use of an <code>Application</code> subclass is the only way to guarantee portability.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-url-space">The path in the application&#8217;s URL space in which MVC controllers live must be specified either using the <code>@ApplicationPath</code> annotation on the application subclass or in the web.xml as part of the <code>url-pattern</code> element</span>.
MVC applications SHOULD use a non-empty path or pattern: i.e., <em>"/"</em> or <em>"/*"</em> should be avoided whenever possible.
The reason for this is that MVC implementations often forward requests to the Servlet container,
and the use of the aforementioned values may result in the unwanted processing of the forwarded request by the JAX-RS servlet once again.</p>
</div>
</div>
<div class="sect2">
<h3 id="mvc_context">6.2. MVC Context</h3>
<div class="paragraph">
<p><span class="tck-testable tck-id-injection">MVC applications can inject an instance of <code>MvcContext</code> to access configuration, security and path-related information</span>.
<span class="tck-testable tck-id-request-scope">Instances of <code>MvcContext</code> are provided by implementations and are always in request scope</span>.
<span class="tck-testable tck-id-el-access">For convenience, the <code>MvcContext</code> instance is also available using the name <code>mvc</code> in EL</span>.</p>
</div>
<div class="paragraph">
<p>As an example, a view can refer to a controller by using the base path available in the <code>MvcContext</code> object as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;a href="${mvc.basePath}/books"&gt;Click here&lt;/a&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on security see the Chapter on <a href="#security">Security</a>; for more information about the <code>MvcContext</code> in general, refer to the Javadoc for the type.</p>
</div>
</div>
<div class="sect2">
<h3 id="providers_in_mvc">6.3. Providers in MVC</h3>
<div class="paragraph">
<p>Implementations are free to use their own providers in order to modify the standard JAX-RS pipeline for the purpose of implementing the MVC semantics.
Whenever mixing implementation and application providers, care should be taken to ensure the correct execution order using priorities.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotation_inheritance">6.4. Annotation Inheritance</h3>
<div class="paragraph">
<p>MVC applications MUST follow the annotation inheritance rules defined by JAX-RS.
Namely, MVC annotations may be used on methods of a super-class or an implemented interface.
<span class="tck-testable tck-id-inheritance">Such annotations are inherited by a corresponding sub-class or implementation class method provided that the method does not have any MVC or JAX-RS annotations of its own</span>:
i.e., if a subclass or implementation method has any MVC or JAX-RS annotations then all of the annotations on the superclass or interface method are ignored.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-class-vs-iface">Annotations on a super-class take precedence over those on an implemented interface</span>.
The precedence over conflicting annotations defined in multiple implemented interfaces is implementation dependent.
Note that, in accordance to the JAX-RS rules, inheritance of class or interface annotations is not supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration_in_mvc">6.5. Configuration in MVC</h3>
<div class="paragraph">
<p>Implementations MUST support configuration via the native JAX-RS configuration mechanism but MAY support other configuration sources.</p>
</div>
<div class="paragraph">
<p>There are concrete configurations, that all MVC the implementations are <code>REQUIRED</code> the support such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ViewEngine.VIEW_FOLDER</code></p>
</li>
<li>
<p><code>Csrf.CSRF_PROTECTION</code></p>
</li>
<li>
<p><code>Csrf.CSRF_HEADER_NAME</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example of how you can configure a custom location for the view folder other than the <code>/WEB-INF/views</code>, simply by overwriting the <code>getProperties</code> method of the subclass <code>Application</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationPath("resources")
public class MyApplication extends Application {

    @Override
    public Map&lt;String, Object&gt; getProperties() {
        final Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(ViewEngine.VIEW_FOLDER, "/jsp/");
        return map;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="view_engines">7. View Engines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces the notion of a view engine as the mechanism by which views are processed in MVC.
The set of available view engines is extensible via CDI, enabling applications as well as other frameworks to provide support for additional view languages.</p>
</div>
<div class="sect2">
<h3 id="view_engines_introduction">7.1. Introduction</h3>
<div class="paragraph">
<p>A <em>view engine</em> is responsible for processing views. In this context, processing entails (i) locating and loading a view (ii) preparing any
required models and (iii) rendering the view and writing the result back to the client.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-jsp-facelets">Implementations MUST provide built-in support for JSPs and Facelets view engines</span>.
Additional engines may be supported via an extension mechanism based on CDI.
<span class="tck-testable tck-id-cdi-discovery">Namely, any CDI bean that implements the <code>javax.mvc.engine.ViewEngine</code> interface MUST be considered as a possible target for processing by calling its <code>supports</code> method, discarding the engine if this method returns <code>false</code></span>.</p>
</div>
<div class="paragraph">
<p>This is the interface that must be implemented by all MVCview engines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * &lt;p&gt;View engines are responsible for processing views and are discovered
 * using CDI. Implementations must look up all instances of this interface,
 * and process a view as follows:
 * &lt;ol&gt;
 *     &lt;li&gt;Gather the set of candidate view engines by calling {@link #supports(String)}
 *     and discarding engines that return &lt;code&gt;false&lt;/code&gt;.&lt;/li&gt;
 *     &lt;li&gt;Sort the resulting set of candidates using priorities. View engines
 *     can be decorated with {@link javax.annotation.Priority} to indicate
 *     their priority; otherwise the priority is assumed to be {@link ViewEngine#PRIORITY_APPLICATION}.&lt;/li&gt;
 *     &lt;li&gt;If more than one candidate is available, choose one in an
 *     implementation-defined manner.&lt;/li&gt;
 *     &lt;li&gt;Fire a {@link javax.mvc.event.BeforeProcessViewEvent} event.&lt;/li&gt;
 *     &lt;li&gt;Call method {@link #processView(ViewEngineContext)} to process view.&lt;/li&gt;
 *     &lt;li&gt;Fire a {@link javax.mvc.event.AfterProcessViewEvent} event.&lt;/li&gt;
 * &lt;/ol&gt;
 * &lt;p&gt;The default view engines for JSPs and Facelets use file extensions to determine
 * support. Namely, the default JSP view engine supports views with extensions &lt;code&gt;jsp&lt;/code&gt;
 * and &lt;code&gt;jspx&lt;/code&gt;, and the one for Facelets supports views with extension
 * &lt;code&gt;xhtml&lt;/code&gt;.&lt;/p&gt;
 *
 * @author Santiago Pericas-Geertsen
 * @see javax.annotation.Priority
 * @see javax.mvc.event.BeforeProcessViewEvent
 * @since 1.0
 */
@SuppressWarnings("unused")
public interface ViewEngine {

    /**
     * Name of property that can be set to override the root location for views in an archive.
     *
     * @see javax.ws.rs.core.Application#getProperties()
     */
    String VIEW_FOLDER = "javax.mvc.engine.ViewEngine.viewFolder";

    /**
     * Default value for property {@link #VIEW_FOLDER}.
     */
    String DEFAULT_VIEW_FOLDER = "/WEB-INF/views/";

    /**
     * Priority for all built-in view engines.
     */
    int PRIORITY_BUILTIN = 1000;

    /**
     * Recommended priority for all view engines provided by frameworks built
     * on top of MVC implementations.
     */
    int PRIORITY_FRAMEWORK = 2000;

    /**
     * Recommended priority for all application-provided view engines (default).
     */
    int PRIORITY_APPLICATION = 3000;

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if this engine can process the view or &lt;code&gt;false&lt;/code&gt;
     * otherwise.
     *
     * @param view the view.
     * @return outcome of supports test.
     */
    boolean supports(String view);

    /**
     * &lt;p&gt;Process a view given a {@link javax.mvc.engine.ViewEngineContext}. Processing
     * a view involves &lt;i&gt;merging&lt;/i&gt; the model and template data and writing
     * the result to an output stream.&lt;/p&gt;
     *
     * &lt;p&gt;Following the Java EE threading model, the underlying view engine implementation
     * must support this method being called by different threads. Any resources allocated
     * during view processing must be released before the method returns.&lt;/p&gt;
     *
     * @param context the context needed for processing.
     * @throws ViewEngineException if an error occurs during processing.
     */
    void processView(ViewEngineContext context) throws ViewEngineException;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="selection_algorithm">7.2. Selection Algorithm</h3>
<div class="paragraph">
<p><span class="tck-testable tck-id-selection-algo">Implementations should perform the following steps while trying to find a suitable view engine for a view</span>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lookup all instances of <code>javax.mvc.engine.ViewEngine</code> available via CDI.</p>
</li>
<li>
<p>Call <code>supports</code> on every view engine found in the previous step, discarding those that return <code>false</code>.</p>
</li>
<li>
<p>If the resulting set is empty, return <code>null</code>.</p>
</li>
<li>
<p>Otherwise, sort the resulting set in descending order of priority using the integer value from the <code>@Priority</code> annotation decorating the view engine class or the default value <code>ViewEngine.PRIORITY_APPLICATION</code> if the annotation is not present.</p>
</li>
<li>
<p>Return the first element in the resulting sorted set, that is, the view engine with the highest priority that supports the given view.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a view engine that can process a view is not found, implementations SHOULD throw a corresponding exception and stop to process the request.</p>
</div>
<div class="paragraph">
<p>The <code>processView</code> method has all the information necessary for processing in the <code>ViewEngineContext</code>, including the view, a reference to <code>Models</code>, as well as the underlying <code>OutputStream</code> that can be used to send the result to the client.</p>
</div>
<div class="paragraph">
<p>Prior to the view render phase, all entries available in <code>Models</code> MUST be bound in such a way that they become available to the view being processed.
The exact mechanism for this depends on the actual view engine implementation.
<span class="tck-testable tck-id-models-binding">In the case of the built-in view engines for JSPs and Facelets, entries in <code>Models</code> must be bound by calling <code>HttpServletRequest.setAttribute(String, Object)</code></span>.
Calling this method ensures access to the named models from EL expressions.</p>
</div>
<div class="paragraph">
<p>A view returned by a controller method represents a path within an application archive.
<span class="tck-testable tck-id-path-relative">If the path is relative, does not start with <code>/</code>, implementations MUST resolve view paths relative to the view folder, which defaults to <code>/WEB-INF/views/</code></span>.
<span class="tck-testable tck-id-path-absolute">If the path is absolute, no further processing is required</span>.
It is recommended to use relative paths and a location under <code>WEB-INF</code> to prevent direct access to views as static resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="faces_servlet">7.3. FacesServlet</h3>
<div class="paragraph">
<p>Because Facelets support is not enabled by default, MVC applications that use Facelets are required to package a <code>web.xml</code> deployment descriptor with the following entry mapping the extension <code>*.xhtml</code> as shown next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;servlet&gt;
    &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;javax.faces.webapp.FacesServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.xhtml&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively to a <code>web.xml</code> deployment descriptor an empty <code>faces-config.xml</code> file can be placed in the <code>WEB-INF</code> folder to enable Facelets support.</p>
</div>
<div class="paragraph">
<p>It is worth noting that if you opt to use Facelets as a view technology for your MVC application, regular JSF post-backs will not be processed by the MVC runtime.
The usage of <code>&lt;h:form /&gt;</code> and depending form components like <code>&lt;h:inputText /&gt;</code> is not recommended as they would be the entry point to a real JSF application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="i18n">8. Internationalization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces the notion of a <em>request locale</em> and describes how MVC handles internationalization and localization.</p>
</div>
<div class="sect2">
<h3 id="i18n_introduction">8.1. Introduction</h3>
<div class="paragraph">
<p>Internationalization and localization are very important concepts for any web application framework.
Therefore MVChas been designed to make supporting multiple languages and regional differences in applications very easy.</p>
</div>
<div class="paragraph">
<p>MVCdefines the term <em>request locale</em> as the locale which is used for any locale-dependent operation within the lifecycle of a request.
The request locale MUST be resolved exactly once for each request using the resolving algorithm described in the <a href="#i18n_resolving_algorithm">Resolving Algorithm</a> section.</p>
</div>
<div class="paragraph">
<p>These locale-dependent operations include, but are not limited to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Data type conversion as part of the data binding mechanism.</p>
</li>
<li>
<p>Formatting of data when rendering it to the view.</p>
</li>
<li>
<p>Generating binding and validation error messages in the specific language.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-mvc-context-locale">The request locale is available from <code>MvcContext</code> and can be used by controllers, view engines and other components</span> to perform operations which depend on the current locale.
The example below shows a controller that uses the request locale to create a <code>NumberFormat</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller
@Path("/foobar")
public class MyController {

    @Inject
    private MvcContext mvc;

    @GET
    public String get() {
        Locale locale = mvc.getLocale();
        NumberFormat format = NumberFormat.getInstance(locale);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sections will explain the locale resolving algorithm and the default resolver provided by the MVCimplementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="i18n_resolving_algorithm">8.2. Resolving Algorithm</h3>
<div class="paragraph">
<p>The <em>locale resolver</em> is responsible to detect the request locale for each request processed by the MVCruntime.
A locale resolver MUST implement the <code>javax.mvc.locale.LocaleResolver</code> interface which is defined like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * &lt;p&gt;Locale resolvers are used to determine the locale of the current request and are discovered
 * using CDI.&lt;/p&gt;
 *
 * &lt;p&gt;The MVC implementation is required to resolve the locale for each request following this
 * algorithm:&lt;/p&gt;
 *
 * &lt;ol&gt;
 * &lt;li&gt;Gather the set of all implementations of this interface available for injection via
 * CDI.&lt;/li&gt;
 * &lt;li&gt;Sort the set of implementations using priorities in descending order. Locale resolvers
 * can be decorated with {@link javax.annotation.Priority} to indicate their priority. If no
 * priority is explicitly defined, the priority is assumed to be &lt;code&gt;1000&lt;/code&gt;.&lt;/li&gt;
 * &lt;li&gt;Call the method {@link #resolveLocale(LocaleResolverContext)}. If the resolver returns
 * a valid locale, use this locale as the request locale. If the resolver returns
 * &lt;code&gt;null&lt;/code&gt;, proceed with the next resolver in the ordered set.&lt;/li&gt;
 * &lt;/ol&gt;
 *
 * &lt;p&gt;Controllers, view engines and other components can access the resolved locale by calling
 * {@link MvcContext#getLocale()}.&lt;/p&gt;
 *
 * &lt;p&gt;The MVC implementation is required to provide a default locale resolver with a priority
 * of &lt;code&gt;0&lt;/code&gt; which uses the &lt;code&gt;Accept-Language&lt;/code&gt; request header to obtain the
 * locale. If resolving the locale this way isn't possible, the default resolver must return
 * {@link Locale#getDefault()}.&lt;/p&gt;
 *
 * @author Christian Kaltepoth
 * @see javax.mvc.locale.LocaleResolverContext
 * @see MvcContext#getLocale()
 * @see java.util.Locale
 * @since 1.0
 */
public interface LocaleResolver {

    /**
     * &lt;p&gt;Resolve the locale of the current request given a {@link LocaleResolverContext}.&lt;/p&gt;
     *
     * &lt;p&gt;If the implementation is able to resolve the locale for the request, the corresponding
     * locale must be returned. If the implementation cannot resolve the locale, it must return
     * &lt;code&gt;null&lt;/code&gt;. In this case the resolving process will continue with the next
     * resolver.&lt;/p&gt;
     *
     * @param context the context needed for processing.
     * @return The resolved locale or &lt;code&gt;null&lt;/code&gt;.
     */
    Locale resolveLocale(LocaleResolverContext context);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There may be more than one locale resolver for a MVCapplication. Locale resolvers are discovered using CDI.
<span class="tck-testable tck-id-resolver-discovery">Every CDI bean implementing the <code>LocaleResolver</code> interface and visible to the application participates in the locale resolving algorithm</span>.</p>
</div>
<div class="paragraph">
<p><span class="tck-testable tck-id-resolve-algorithm">Implementations MUST use the following algorithm to resolve the request locale for each request</span>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain a list of all CDI beans implementing the <code>LocaleResolver</code> interface visible to the applications <code>BeanManager</code>.</p>
</li>
<li>
<p>Sort the list of locale resolvers in descending order of priority using the integer value from the <code>@Priority</code> annotation decorating the resolver class.<br>
If no <code>@Priority</code> annotation is present, assume a default priority of <code>1000</code>.</p>
</li>
<li>
<p>Call <code>resolveLocale()</code> on the first resolver in the list. If the resolver returns <code>null</code>, continue with the next resolver in the list.<br>
If a resolver returns a non-null result, stop the algorithm and use the returned locale as the request locale.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Applications can either rely on the default locale resolver which is described in the <a href="#i18n_default_resolver">Default Locale Resolver</a> section
or provide a custom resolver which implements some other strategy for resolving the request locale.
A custom strategy could for example track the locale using the session, a query parameter or the servers hostname.</p>
</div>
</div>
<div class="sect2">
<h3 id="i18n_default_resolver">8.3. Default Locale Resolver</h3>
<div class="paragraph">
<p><span class="tck-testable tck-id-default-locale-resolver">Every MVCimplementation MUST provide a default locale resolver with a priority of <code>0</code> which resolves the request locale according to the following algorithm</span>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First check whether the client provided an <code>Accept-Language</code> request header. If this is the case, the locale with the highest quality factor is returned as the result.</p>
</li>
<li>
<p>If the previous step was not successful, return the system default locale of the server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Please note that applications can customize the locale resolving process by providing a custom locale resolver with a priority higher than <code>0</code>.
See the <a href="#i18n_resolving_algorithm">Resolving Algorithm</a> section for details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotation_table">Appendix A: Summary of Annotations</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type or method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a resource method as an MVC controller. If
specified at the type level, it defines all methods in a class
as controllers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>View</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type or method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares a view for a controller method that returns void.
If specified at the type level, it applies to all controller
methods that return void in a class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CsrfValid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">States that a CSRF token must be validated before
invoking the controller. Failure to validate the CSRF
token results in a <code>ForbiddenException</code> thrown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RedirectScoped</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type, method or field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that a certain bean is in redirect scope.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UriRef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a symbolic name for a controller method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MvcBinding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field, method or parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares that constraint violations will be handled by a
controller through <code>BindingResult</code> instead of triggering
a <code>ConstraintViolationException</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="bibliography">Bibliography</h2>
<div class="sectionbody">
<div id="jsf22" class="dlist">
<dl>
<dt class="hdlist1">[1]</dt>
<dd>
<p>Edward Burns. JavaServer Faces 2.2. JSR, JCP, May 2013<br>
<a href="http://jcp.org/en/jsr/detail?id=344" class="bare">http://jcp.org/en/jsr/detail?id=344</a></p>
</dd>
</dl>
</div>
<div id="cdi11" class="dlist">
<dl>
<dt class="hdlist1">[2]</dt>
<dd>
<p>Pete Muir. Context and Dependency Injection for Java EE 1.1 MR. JSR, JCP, April 2014<br>
<a href="http://jcp.org/en/jsr/detail?id=346" class="bare">http://jcp.org/en/jsr/detail?id=346</a></p>
</dd>
</dl>
</div>
<div id="bv11" class="dlist">
<dl>
<dt class="hdlist1">[3]</dt>
<dd>
<p>Emmanuel Bernard. Bean Validation 1.1. JSR, JCP, March 2013<br>
<a href="http://jcp.org/en/jsr/detail?id=349" class="bare">http://jcp.org/en/jsr/detail?id=349</a></p>
</dd>
</dl>
</div>
<div id="rfc2119" class="dlist">
<dl>
<dt class="hdlist1">[4]</dt>
<dd>
<p>S. Bradner. RFC 2119: Keywords for use in RFCs to Indicate Requirement Levels. RFC, IETF, March 1997<br>
<a href="http://www.ietf.org/rfc/rfc2119.txt" class="bare">http://www.ietf.org/rfc/rfc2119.txt</a></p>
</dd>
</dl>
</div>
<div id="jaxrs20" class="dlist">
<dl>
<dt class="hdlist1">[5]</dt>
<dd>
<p>Santiago Pericas-Geertsen and Marek Potociar. The Java API for RESTful Web Services 2.0 MR. JSR, JCP, October 2014<br>
<a href="http://jcp.org/en/jsr/detail?id=339" class="bare">http://jcp.org/en/jsr/detail?id=339</a></p>
</dd>
</dl>
</div>
<div id="el30" class="dlist">
<dl>
<dt class="hdlist1">[6]</dt>
<dd>
<p>Kin man Chung. Expression Language 3.0. JSR, JCP, May 2013<br>
<a href="http://jcp.org/en/jsr/detail?id=341" class="bare">http://jcp.org/en/jsr/detail?id=341</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0 Proposed Final Draft<br>
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>